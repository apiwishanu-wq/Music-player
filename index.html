<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Music Player (Admin Demo)</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f7fa; margin: 0; padding: 0; }
    .player-container { max-width: 600px; margin: 40px auto; background: white; padding: 24px 32px 32px; border-radius: 12px; box-shadow: 0 2px 12px #0001; }
    h2, h3, h4 { margin-top: 0; }
    .playlist-item { padding: 6px 0; cursor: pointer; border-bottom: 1px solid #eee; }
    .playlist-item.active { background: #eaeaea; font-weight: bold;}
    #adminSection { margin-top:30px; padding:15px; background:#f9fafb; border-radius:10px; border:1px solid #ddd; }
    #broadcastMsg { margin-top:20px; background:#fefcbf; color:#744210; padding:10px; border-radius:6px; }
    .btn { padding:3px 10px; border-radius:4px; border:none; background:#c6e2ff; cursor:pointer; }
    .btn-danger { background: #ffb3b3; color:#900; }
    .btn-sm { font-size: 0.9em; }
    .input { padding:3px 7px; font-size:1em; }
    .flex { display:flex; align-items:center; gap:8px; }
  </style>
</head>
<body>
  <div class="player-container" id="playerContainer">
    <h2>Music Player</h2>

    <!-- Login Section -->
    <div id="loginSection">
      <div class="flex">
        <input id="loginUsername" class="input" placeholder="Username">
        <input id="loginPassword" class="input" type="password" placeholder="Password">
        <button id="loginBtn" class="btn">Login</button>
      </div>
    </div>
    <div id="userSection" style="display:none;">
      <span id="welcomeMsg"></span>
      <button id="logoutBtn" class="btn btn-sm" style="float:right;">Logout</button>
    </div>

    <!-- Broadcast message for all users -->
    <div id="broadcastMsg" style="display:none;"></div>

    <hr>
    <h3>Now Playing</h3>
    <iframe id="videoPlayer" width="100%" height="315" src="" frameborder="0" allowfullscreen></iframe>

    <h4>Playlist</h4>
    <div id="playlistContainer"></div>
    <div id="addSongSection" style="margin-top:15px;">
      <input id="youtubeUrl" class="input" placeholder="YouTube URL">
      <button id="addUrlBtn" class="btn">Add</button>
    </div>

    <!-- Admin Dashboard Section -->
    <div id="adminSection" style="display:none;">
      <h3>Admin Dashboard</h3>

      <!-- User Management -->
      <div>
        <h4>User Management</h4>
        <ul id="userList"></ul>
      </div>

      <!-- Playlist Management -->
      <div>
        <h4>Playlist Management</h4>
        <ul id="adminPlaylist"></ul>
      </div>

      <!-- Broadcast Message -->
      <div style="margin-top:18px;">
        <h4>Broadcast Message</h4>
        <input type="text" id="broadcastInput" placeholder="Message to all users" style="width:70%;" class="input" />
        <button id="broadcastBtn" class="btn btn-sm">Send</button>
        <span id="broadcastStatus" style="color:green; margin-left:10px;"></span>
      </div>
    </div>
  </div>
  <script>
    // --- Initial Demo Data ---
    let users = [
      { username: 'admin', password: 'admin', email: 'admin@music.com' },
      { username: 'alice', password: 'alice', email: 'alice@email.com' },
      { username: 'bob', password: 'bob', email: 'bob@email.com' }
    ];
    let playlist = [];
    let currentTrack = 0;
    let currentUser = null;
    let broadcastMessage = '';

    // --- Elements ---
    const loginSection = document.getElementById('loginSection');
    const loginBtn = document.getElementById('loginBtn');
    const loginUsername = document.getElementById('loginUsername');
    const loginPassword = document.getElementById('loginPassword');
    const userSection = document.getElementById('userSection');
    const welcomeMsg = document.getElementById('welcomeMsg');
    const logoutBtn = document.getElementById('logoutBtn');
    const playlistContainer = document.getElementById('playlistContainer');
    const addUrlBtn = document.getElementById('addUrlBtn');
    const youtubeUrl = document.getElementById('youtubeUrl');
    const videoPlayer = document.getElementById('videoPlayer');
    const adminSection = document.getElementById('adminSection');
    const userList = document.getElementById('userList');
    const adminPlaylist = document.getElementById('adminPlaylist');
    const broadcastInput = document.getElementById('broadcastInput');
    const broadcastBtn = document.getElementById('broadcastBtn');
    const broadcastStatus = document.getElementById('broadcastStatus');
    const broadcastMsg = document.getElementById('broadcastMsg');
    const addSongSection = document.getElementById('addSongSection');

    // --- Login Logic ---
    loginBtn.onclick = () => {
      const un = loginUsername.value.trim();
      const pw = loginPassword.value.trim();
      const found = users.find(u => u.username === un && u.password === pw);
      if (!found) {
        alert('Invalid credentials');
        return;
      }
      currentUser = found;
      loginSection.style.display = 'none';
      userSection.style.display = '';
      welcomeMsg.textContent = `Welcome, ${currentUser.username}!`;
      addSongSection.style.display = '';
      renderPlaylist();

      // Admin section
      if (currentUser.username === 'admin') {
        adminSection.style.display = 'block';
        renderUserList();
        renderAdminPlaylist();
      } else {
        adminSection.style.display = 'none';
      }

      // Show broadcast if set
      if (broadcastMessage) {
        broadcastMsg.style.display = 'block';
        broadcastMsg.textContent = broadcastMessage;
      } else {
        broadcastMsg.style.display = 'none';
        broadcastMsg.textContent = '';
      }
    };

    logoutBtn.onclick = () => {
      currentUser = null;
      loginSection.style.display = '';
      userSection.style.display = 'none';
      adminSection.style.display = 'none';
      addSongSection.style.display = '';
      broadcastMsg.style.display = 'none';
      renderPlaylist();
    };

    // --- Playlist Logic ---
    addUrlBtn.onclick = () => {
      const url = youtubeUrl.value.trim();
      if (!url) return;
      const id = getYouTubeId(url);
      if (!id) {
        alert('Invalid YouTube URL');
        return;
      }
      playlist.push({id, title: 'YouTube Video', addedBy: currentUser ? currentUser.username : 'unknown'});
      youtubeUrl.value = '';
      renderPlaylist();
      if (currentUser && currentUser.username === 'admin') renderAdminPlaylist();
    };

    function getYouTubeId(url) {
      const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?(?:.*&)?v=|embed\/|v\/))([\w-]{11})/);
      return match ? match[1] : null;
    }

    function renderPlaylist(){
      playlistContainer.innerHTML='';
      playlist.forEach((track,i)=>{
        const div=document.createElement('div');
        div.textContent=`${track.title} [by ${track.addedBy||'unknown'}]`;
        div.className='playlist-item'+(i===currentTrack?' active':'');
        div.onclick=()=>{ playTrack(i); }
        playlistContainer.appendChild(div);
      });
      // Play first track if nothing is playing
      if (playlist.length && videoPlayer.src === '') {
        playTrack(0);
      }
    }

    function playTrack(idx) {
      if (!playlist[idx]) return;
      currentTrack = idx;
      videoPlayer.src = 'https://www.youtube.com/embed/' + playlist[idx].id + '?autoplay=1';
      renderPlaylist();
    }

    // --- User Management (Admin Only) ---
    function renderUserList() {
      userList.innerHTML = '';
      users.forEach((user, idx) => {
        if (user.username === 'admin') return; // Don't allow deleting admin
        const li = document.createElement('li');
        li.textContent = `${user.username} (${user.email || 'no email'}) `;
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.className = "btn btn-danger btn-sm";
        delBtn.onclick = () => {
          users.splice(idx, 1);
          renderUserList();
        };
        li.appendChild(delBtn);
        userList.appendChild(li);
      });
    }

    // --- Playlist Management (Admin Only) ---
    function renderAdminPlaylist() {
      adminPlaylist.innerHTML = '';
      playlist.forEach((track, i) => {
        const li = document.createElement('li');
        li.textContent = `[${track.addedBy}] ${track.title} `;
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Remove';
        delBtn.className = "btn btn-danger btn-sm";
        delBtn.onclick = () => {
          playlist.splice(i, 1);
          renderAdminPlaylist();
          renderPlaylist();
        };
        li.appendChild(delBtn);
        adminPlaylist.appendChild(li);
      });
    }

    // --- Broadcast Message (Admin Only) ---
    broadcastBtn.onclick = () => {
      broadcastMessage = broadcastInput.value.trim();
      if (broadcastMessage) {
        broadcastStatus.textContent = "Message sent!";
        broadcastMsg.style.display = 'block';
        broadcastMsg.textContent = broadcastMessage;
      } else {
        broadcastStatus.textContent = '';
        broadcastMsg.style.display = 'none';
        broadcastMsg.textContent = '';
      }
      setTimeout(() => broadcastStatus.textContent = '', 2000);
    };

    // --- Hide Add Song Section for Non-logged-in Users ---
    addSongSection.style.display = 'none';
    // --- Auto-login as admin for demo (optional, you can remove this for real use) ---
    // loginUsername.value = 'admin'; loginPassword.value = 'admin';
    // loginBtn.click();
  </script>
</body>
</html>
