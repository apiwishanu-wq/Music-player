<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Music Player</title>
    <!-- YouTube API -->
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }

        .player-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: none;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .signup-link {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .signup-link:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .form-group small {
            font-size: 12px;
            margin-top: 4px;
            display: block;
        }

        .success-message {
            background: linear-gradient(135deg, #10ac84, #1dd1a1);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }

        .error-message {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }

        .search-section {
            padding: 30px;
            background: white;
        }

        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(255, 107, 107, 0.3);
        }

        .video-player {
            margin-bottom: 30px;
            text-align: center;
        }

        .player-status {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .video-player iframe {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            height: 400px;
        }

        .now-playing {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .now-playing.active {
            display: block;
        }

        .now-playing-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .now-playing-info img {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }

        .now-playing-details h4 {
            margin-bottom: 5px;
            color: #333;
        }

        .now-playing-details p {
            color: #666;
            font-size: 14px;
        }

        .playlist {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
        }

        .playlist h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 20px;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .playlist-item:hover {
            transform: translateX(5px);
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .playlist-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .playlist-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .track-info h4 {
            margin-bottom: 5px;
            font-size: 16px;
        }

        .track-info p {
            color: #666;
            font-size: 14px;
        }

        .remove-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 12px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            background: #ee5a24;
            transform: scale(1.1);
        }

        .playlist-item.active .remove-btn {
            background: rgba(255, 255, 255, 0.3);
        }

        .playlist-item.active .remove-btn:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .control-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(102, 126, 234, 0.3);
        }

        .url-input-container {
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .url-input-container h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .url-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 14px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .url-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .url-input:valid {
            border-color: #10ac84;
        }

        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            color: #666;
            border-left: 4px solid #667eea;
        }

        .add-btn {
            background: linear-gradient(135deg, #10ac84, #1dd1a1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-results {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .search-results h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .search-result-item:hover {
            transform: translateX(5px);
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .search-result-item img {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .search-result-info {
            flex: 1;
        }

        .search-result-info h5 {
            margin-bottom: 5px;
            color: #333;
            font-size: 14px;
            line-height: 1.3;
        }

        .search-result-info p {
            color: #666;
            font-size: 12px;
            margin-bottom: 2px;
        }

        .add-to-playlist-btn {
            background: linear-gradient(135deg, #10ac84, #1dd1a1);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .add-to-playlist-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(16, 172, 132, 0.3);
        }

        .loading-spinner {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .api-info {
            background: linear-gradient(135deg, #ffa502, #ff6348);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .api-info a {
            color: white;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .video-player iframe {
                width: 100%;
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div id="loginContainer" class="login-container">
            <form class="login-form" id="loginForm">
                <h2>🎵 Music Player Login</h2>
                <div class="form-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" name="loginUsername" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" name="loginPassword" required>
                </div>
                <button type="submit" class="login-btn">Login to Music Player</button>
                <div style="text-align: center; margin-top: 20px;">
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                        Don't have an account?
                    </p>
                    <button type="button" class="signup-link" id="showSignupBtn">Create Account</button>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px;">
                    <p style="text-align: center; margin-bottom: 10px; color: #333; font-weight: 600;">
                        Demo Accounts Available:
                    </p>
                    <div style="font-size: 12px; color: #666; line-height: 1.4;">
                        <strong>admin</strong> / password<br>
                        <strong>musiclover</strong> / 123456<br>
                        <strong>dj_mike</strong> / djmike<br>
                        <strong>sarah_beats</strong> / sarah123<br>
                        <strong>rockfan</strong> / rock2024
                    </div>
                </div>
            </form>
        </div>

        <!-- Signup Form -->
        <div id="signupContainer" class="login-container" style="display: none;">
            <form class="login-form" id="signupForm">
                <h2>🎵 Create Account</h2>
                <div class="form-group">
                    <label for="signupUsername">Username</label>
                    <input type="text" id="signupUsername" name="signupUsername" required minlength="3">
                    <small style="color: #666;">At least 3 characters</small>
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" name="signupEmail" required>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" name="signupPassword" required minlength="6">
                    <small style="color: #666;">At least 6 characters</small>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                </div>
                <div class="form-group">
                    <label for="fullName">Full Name (Optional)</label>
                    <input type="text" id="fullName" name="fullName">
                </div>
                <button type="submit" class="login-btn">Create Account</button>
                <div style="text-align: center; margin-top: 20px;">
                    <p style="color: #666; font-size: 14px; margin-bottom: 10px;">
                        Already have an account?
                    </p>
                    <button type="button" class="signup-link" id="showLoginBtn">Back to Login</button>
                </div>
            </form>
        </div>

        <!-- Music Player -->
        <div id="playerContainer" class="player-container">
            <div class="header">
                <div class="logo">
                    🎵 YouTube Music Player
                </div>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>

            <div class="search-section">
                <div class="api-info">
                    <strong>🔑 YouTube Music Player</strong><br>
                    Ready to play with 8+ sample tracks loaded! Add your own YouTube videos or try the demo accounts.<br>
                    Search feature requires YouTube Data API key for full functionality.
                </div>
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search YouTube for music videos..." />
                    <button class="search-btn" id="searchBtn">🔍 Search YouTube</button>
                </div>

                <div id="searchResults" class="search-results" style="display: none;">
                    <h4>Search Results:</h4>
                    <div id="searchResultsContainer"></div>
                </div>

                <div class="url-input-container">
                    <h4>Add YouTube Video to Playlist:</h4>
                    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        Paste any YouTube URL (e.g., https://www.youtube.com/watch?v=dQw4w9WgXcQ)
                    </p>
                    <input type="text" class="url-input" id="urlInput" 
                           placeholder="Paste YouTube URL here..." 
                           value="" />
                    <button class="add-btn" id="addUrlBtn">+ Add to Playlist</button>
                    <div style="margin-top: 10px;">
                        <small style="color: #999;">
                            <strong>Try these working examples:</strong><br>
                            • https://www.youtube.com/watch?v=jNQXAC9IVRw<br>
                            • https://youtu.be/jNQXAC9IVRw<br>
                            • jNQXAC9IVRw (just the video ID)<br><br>
                            <strong>Note:</strong> Some videos may be restricted from embedding.
                        </small>
                    </div>
                </div>

                <div class="video-player">
                    <div id="playerStatus" class="player-status">Ready to play music! 🎵</div>
                    <div id="nowPlaying" class="now-playing">
                        <div class="now-playing-info">
                            <img id="nowPlayingImage" src="" alt="Now Playing">
                            <div class="now-playing-details">
                                <h4 id="nowPlayingTitle">No track selected</h4>
                                <p id="nowPlayingArtist">Select a song to play</p>
                            </div>
                        </div>
                    </div>
                    <iframe id="videoPlayer" width="600" height="400" frameborder="0" allowfullscreen 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            src=""></iframe>
                </div>

                <div class="controls">
                    <button class="control-btn" id="prevBtn">⏮ Previous</button>
                    <button class="control-btn" id="playPauseBtn">⏸ Pause</button>
                    <button class="control-btn" id="nextBtn">Next ⏭</button>
                </div>

                <div class="playlist">
                    <h3>🎵 Your Playlist</h3>
                    <div id="playlistContainer">
                        <!-- Playlist items will be added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class MusicPlayer {
            constructor() {
                this.playlist = [];
                this.currentTrack = 0;
                this.isLoggedIn = false;
                this.users = this.loadUsers();
                this.currentUser = null;
                this.youtubeApiKey = null; // Set this to your YouTube API key
                this.isYouTubeAPIReady = false;
                this.initializeElements();
                this.bindEvents();
                this.loadSamplePlaylist();
                this.initializeYouTubeAPI();
            }

            loadUsers() {
                // Default users for demo with more variety
                return [
                    { username: 'admin', password: 'password', email: 'admin@example.com', fullName: 'Admin User', createdAt: '2024-01-01' },
                    { username: 'musiclover', password: '123456', email: 'music@example.com', fullName: 'Music Lover', createdAt: '2024-02-15' },
                    { username: 'dj_mike', password: 'djmike', email: 'mike@example.com', fullName: 'DJ Mike', createdAt: '2024-03-10' },
                    { username: 'sarah_beats', password: 'sarah123', email: 'sarah@example.com', fullName: 'Sarah Johnson', createdAt: '2024-04-05' },
                    { username: 'rockfan', password: 'rock2024', email: 'rock@example.com', fullName: 'Rock Fan', createdAt: '2024-05-20' }
                ];
            }

            initializeYouTubeAPI() {
                // Initialize YouTube API (demo mode without API key)
                if (typeof gapi !== 'undefined') {
                    gapi.load('client', () => {
                        // In production, you would initialize with your API key:
                        // gapi.client.init({
                        //     apiKey: this.youtubeApiKey,
                        //     discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest']
                        // }).then(() => {
                        //     this.isYouTubeAPIReady = true;
                        // });
                        
                        // For demo, we'll simulate API readiness
                        setTimeout(() => {
                            this.isYouTubeAPIReady = true;
                            console.log('YouTube API simulation ready');
                        }, 1000);
                    });
                }
            }

            initializeElements() {
                this.loginContainer = document.getElementById('loginContainer');
                this.signupContainer = document.getElementById('signupContainer');
                this.playerContainer = document.getElementById('playerContainer');
                this.loginForm = document.getElementById('loginForm');
                this.signupForm = document.getElementById('signupForm');
                this.showSignupBtn = document.getElementById('showSignupBtn');
                this.showLoginBtn = document.getElementById('showLoginBtn');
                this.logoutBtn = document.getElementById('logoutBtn');
                this.searchInput = document.getElementById('searchInput');
                this.searchBtn = document.getElementById('searchBtn');
                this.searchResults = document.getElementById('searchResults');
                this.searchResultsContainer = document.getElementById('searchResultsContainer');
                this.urlInput = document.getElementById('urlInput');
                this.addUrlBtn = document.getElementById('addUrlBtn');
                this.videoPlayer = document.getElementById('videoPlayer');
                this.playerStatus = document.getElementById('playerStatus');
                this.nowPlaying = document.getElementById('nowPlaying');
                this.nowPlayingImage = document.getElementById('nowPlayingImage');
                this.nowPlayingTitle = document.getElementById('nowPlayingTitle');
                this.nowPlayingArtist = document.getElementById('nowPlayingArtist');
                this.playlistContainer = document.getElementById('playlistContainer');
                this.prevBtn = document.getElementById('prevBtn');
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.nextBtn = document.getElementById('nextBtn');
            }

            bindEvents() {
                // Form events
                this.loginForm.addEventListener('submit', (e) => this.handleLogin(e));
                this.signupForm.addEventListener('submit', (e) => this.handleSignup(e));
                this.showSignupBtn.addEventListener('click', () => this.showSignup());
                this.showLoginBtn.addEventListener('click', () => this.showLogin());
                this.logoutBtn.addEventListener('click', () => this.handleLogout());
                
                // Player events
                this.searchBtn.addEventListener('click', () => this.handleSearch());
                this.addUrlBtn.addEventListener('click', () => {
                    console.log('Add URL button clicked');
                    this.handleAddUrl();
                });
                this.prevBtn.addEventListener('click', () => this.previousTrack());
                this.nextBtn.addEventListener('click', () => this.nextTrack());
                this.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
                
                // Input events
                this.searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.handleSearch();
                    }
                });
                
                this.urlInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        console.log('Enter pressed in URL input');
                        this.handleAddUrl();
                    }
                });

                // Debug: Log when input changes
                this.urlInput.addEventListener('input', (e) => {
                    console.log('URL input changed:', e.target.value);
                });
            }

            handleSearch() {
                const query = this.searchInput.value.trim();
                if (query) {
                    // In a real app, you'd use YouTube API here
                    alert(`Search functionality would query YouTube API for: "${query}"\n\nFor demo purposes, try adding a YouTube URL directly!`);
                }
            }

            showSignup() {
                this.loginContainer.style.display = 'none';
                this.signupContainer.style.display = 'block';
                this.clearMessages();
            }

            showLogin() {
                this.signupContainer.style.display = 'none';
                this.loginContainer.style.display = 'block';
                this.clearMessages();
            }

            clearMessages() {
                const messages = document.querySelectorAll('.success-message, .error-message');
                messages.forEach(msg => msg.remove());
            }

            showMessage(message, type = 'success') {
                this.clearMessages();
                const messageDiv = document.createElement('div');
                messageDiv.className = `${type}-message`;
                messageDiv.textContent = message;
                
                const activeForm = this.loginContainer.style.display !== 'none' 
                    ? this.loginContainer.querySelector('.login-form')
                    : this.signupContainer.querySelector('.login-form');
                
                activeForm.insertBefore(messageDiv, activeForm.firstChild);
                
                setTimeout(() => messageDiv.remove(), 5000);
            }

            handleSignup(e) {
                e.preventDefault();
                
                const username = document.getElementById('signupUsername').value.trim();
                const email = document.getElementById('signupEmail').value.trim();
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const fullName = document.getElementById('fullName').value.trim();

                // Validation
                if (password !== confirmPassword) {
                    this.showMessage('Passwords do not match!', 'error');
                    return;
                }

                if (password.length < 6) {
                    this.showMessage('Password must be at least 6 characters long!', 'error');
                    return;
                }

                if (username.length < 3) {
                    this.showMessage('Username must be at least 3 characters long!', 'error');
                    return;
                }

                // Check if username already exists
                if (this.users.find(user => user.username.toLowerCase() === username.toLowerCase())) {
                    this.showMessage('Username already exists! Please choose another.', 'error');
                    return;
                }

                // Check if email already exists
                if (this.users.find(user => user.email.toLowerCase() === email.toLowerCase())) {
                    this.showMessage('Email already registered! Please use another email.', 'error');
                    return;
                }

                // Create new user
                const newUser = {
                    username: username,
                    email: email,
                    password: password, // In a real app, this would be hashed
                    fullName: fullName || username,
                    createdAt: new Date().toISOString()
                };

                this.users.push(newUser);
                this.saveUsers();
                
                this.showMessage('Account created successfully! You can now login.', 'success');
                
                // Clear form and switch to login after delay
                setTimeout(() => {
                    this.signupForm.reset();
                    this.showLogin();
                    document.getElementById('loginUsername').value = username;
                }, 2000);
            }

            handleLogin(e) {
                e.preventDefault();
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;
                
                const user = this.users.find(u => 
                    u.username.toLowerCase() === username.toLowerCase() && u.password === password
                );
                
                if (user) {
                    this.isLoggedIn = true;
                    this.currentUser = user;
                    this.loginContainer.style.display = 'none';
                    this.playerContainer.style.display = 'block';
                    
                    // Update welcome message
                    const welcomeMsg = document.querySelector('.logo');
                    welcomeMsg.innerHTML = `🎵 Welcome, ${user.fullName || user.username}!`;
                    
                    // Initialize player with first track if available
                    if (this.playlist.length > 0) {
                        this.playerStatus.textContent = `Ready to play ${this.playlist.length} tracks! Click any song to start 🎵`;
                        this.renderPlaylist();
                    } else {
                        this.playerStatus.textContent = 'Add some music to get started! 🎵';
                    }
                } else {
                    this.showMessage('Invalid username or password!', 'error');
                }
            }

            saveUsers() {
                try {
                    // In a real app, you wouldn't store users in memory
                    // This is just for demo purposes
                    console.log('User data saved in memory for demo');
                } catch (error) {
                    console.log('Note: User data is stored in memory for this demo');
                }
            }

            handleLogout() {
                this.isLoggedIn = false;
                this.currentUser = null;
                this.loginContainer.style.display = 'block';
                this.signupContainer.style.display = 'none';
                this.playerContainer.style.display = 'none';
                
                // Reset form and welcome message
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                document.querySelector('.logo').innerHTML = '🎵 YouTube Music Player';
                this.clearMessages();
            }

            handleSearch() {
                const query = this.searchInput.value.trim();
                if (query) {
                    // In a real app, you'd use YouTube API here
                    alert(`Search functionality would query YouTube API for: "${query}"\n\nFor demo purposes, try adding a YouTube URL directly!`);
                }
            }

            handleAddUrl() {
                const url = this.urlInput.value.trim();
                console.log('Attempting to add URL:', url);
                
                if (!url) {
                    this.showMessage('Please enter a YouTube URL!', 'error');
                    return;
                }
                
                const videoId = this.extractVideoId(url);
                console.log('Extracted video ID:', videoId);
                
                if (videoId) {
                    // Check if already in playlist
                    const existingTrack = this.playlist.find(track => track.id === videoId);
                    if (existingTrack) {
                        this.showMessage('This video is already in your playlist!', 'error');
                        return;
                    }

                    // Create track with basic info
                    const newTrack = {
                        id: videoId,
                        title: `YouTube Video`,
                        artist: 'YouTube',
                        thumbnail: `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`,
                        url: url
                    };
                    
                    // Try to get video info from YouTube thumbnail API
                    this.enhanceTrackInfo(newTrack);
                    
                    console.log('Adding track:', newTrack);
                    
                    this.playlist.push(newTrack);
                    this.renderPlaylist();
                    this.urlInput.value = '';
                    
                    this.showMessage(`Video added to playlist! Click to play.`, 'success');
                    
                    // If this is the first track, update the status
                    if (this.playlist.length === 1) {
                        this.playerStatus.textContent = 'Click the track below to start playing! 🎵';
                    }
                    
                } else {
                    this.showMessage('Invalid YouTube URL! Please check the format and try again.', 'error');
                    console.log('URL parsing failed for:', url);
                    
                    // Show example in console for debugging
                    console.log('Expected formats:');
                    console.log('- https://www.youtube.com/watch?v=dQw4w9WgXcQ');
                    console.log('- https://youtu.be/dQw4w9WgXcQ');
                    console.log('- dQw4w9WgXcQ (just the video ID)');
                }
            }

            enhanceTrackInfo(track) {
                // In a real app, you'd use YouTube API to get video details
                // For demo, we'll use some heuristics based on video ID
                const videoId = track.id;
                
                // Update title with video ID for identification
                track.title = `Video ${videoId.substring(0, 8)}...`;
                
                // Try different thumbnail qualities
                const thumbnailQualities = ['maxresdefault', 'hqdefault', 'mqdefault', 'default'];
                
                // Test thumbnail load and fallback if needed
                const img = new Image();
                img.onload = () => {
                    console.log('Thumbnail loaded successfully');
                };
                img.onerror = () => {
                    console.log('Maxres thumbnail failed, falling back to hqdefault');
                    track.thumbnail = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
                    this.renderPlaylist(); // Re-render with new thumbnail
                };
                img.src = track.thumbnail;
            }

            extractVideoId(url) {
                console.log('Extracting video ID from:', url);
                
                // Clean the URL first
                url = url.trim();
                
                // Handle different YouTube URL formats with more robust patterns
                const patterns = [
                    // Standard youtube.com/watch?v=
                    /(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?(?:.*&)?v=([a-zA-Z0-9_-]{11})/,
                    // Short youtu.be format
                    /(?:https?:\/\/)?(?:www\.)?youtu\.be\/([a-zA-Z0-9_-]{11})/,
                    // Embed format
                    /(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,
                    // YouTube mobile format
                    /(?:https?:\/\/)?(?:m\.)?youtube\.com\/watch\?(?:.*&)?v=([a-zA-Z0-9_-]{11})/,
                    // Just the video ID (11 characters)
                    /^([a-zA-Z0-9_-]{11})$/
                ];
                
                for (const pattern of patterns) {
                    const match = url.match(pattern);
                    if (match && match[1] && match[1].length === 11) {
                        console.log('Pattern matched:', pattern, 'ID:', match[1]);
                        return match[1];
                    }
                }
                
                console.log('No patterns matched for URL:', url);
                return null;
            }

            loadSamplePlaylist() {
                // Load sample tracks that should work with YouTube embedding
                this.playlist = [
                    {
                        id: 'jNQXAC9IVRw',
                        title: 'Me at the zoo',
                        artist: 'jawed',
                        thumbnail: 'https://img.youtube.com/vi/jNQXAC9IVRw/hqdefault.jpg',
                        url: 'https://www.youtube.com/watch?v=jNQXAC9IVRw'
                    },
                    {
                        id: 'kJQP7kiw5Fk',
                        title: 'Despacito',
                        artist: 'Luis Fonsi ft. Daddy Yankee',
                        thumbnail: 'https://img.youtube.com/vi/kJQP7kiw5Fk/hqdefault.jpg',
                        url: 'https://www.youtube.com/watch?v=kJQP7kiw5Fk'
                    },
                    {
                        id: '9bZkp7q19f0',
                        title: 'Gangnam Style',
                        artist: 'PSY',
                        thumbnail: 'https://img.youtube.com/vi/9bZkp7q19f0/hqdefault.jpg',
                        url: 'https://www.youtube.com/watch?v=9bZkp7q19f0'
                    },
                    {
                        id: 'RgKAFK5djSk',
                        title: 'Wiz Khalifa - See You Again',
                        artist: 'Wiz Khalifa ft. Charlie Puth',
                        thumbnail: 'https://img.youtube.com/vi/RgKAFK5djSk/hqdefault.jpg',
                        url: 'https://www.youtube.com/watch?v=RgKAFK5djSk'
                    },
                    {
                        id: 'YQHsXMglC9A',
                        title: 'Hello',
                        artist: 'Adele',
                        thumbnail: 'https://img.youtube.com/vi/YQHsXMglC9A/hqdefault.jpg',
                        url: 'https://www.youtube.com/watch?v=YQHsXMglC9A'
                    },
                    {
                        id: 'CevxZvSJLk8',
                        title: 'Roar',
                        artist: 'Katy Perry',
                        thumbnail: 'https://img.youtube.com/vi/CevxZvSJLk8/hqdefault.jpg',
                        url: 'https://www.youtube.com/watch?v=CevxZvSJLk8'
                    },
                    {
                        id: 'hT_nvWreIhg',
                        title: 'Counting Stars',
                        artist: 'OneRepublic',
                        thumbnail: 'https://img.youtube.com/vi/hT_nvWreIhg/hqdefault.jpg',
                        url: 'https://www.youtube.com/watch?v=hT_nvWreIhg'
                    },
                    {
                        id: 'JGwWNGJdvx8',
                        title: 'Shape of You',
                        artist: 'Ed Sheeran',
                        thumbnail: 'https://img.youtube.com/vi/JGwWNGJdvx8/hqdefault.jpg',
                        url: 'https://www.youtube.com/watch?v=JGwWNGJdvx8'
                    }
                ];
                this.renderPlaylist();
                console.log('Music player initialized with', this.playlist.length, 'sample tracks');
            }

            renderPlaylist() {
                this.playlistContainer.innerHTML = '';
                
                if (this.playlist.length === 0) {
                    this.playlistContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No tracks in playlist. Add some music!</div>';
                    return;
                }
                
                this.playlist.forEach((track, index) => {
                    const playlistItem = document.createElement('div');
                    playlistItem.className = `playlist-item ${index === this.currentTrack ? 'active' : ''}`;
                    playlistItem.addEventListener('click', () => this.playTrack(index));
                    
                    playlistItem.innerHTML = `
                        <img src="${track.thumbnail}" alt="${this.escapeHtml(track.title)}" onerror="this.src='data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"60\" height=\"60\" viewBox=\"0 0 60 60\"><rect width=\"60\" height=\"60\" fill=\"%23f0f0f0\"/><text x=\"30\" y=\"35\" text-anchor=\"middle\" fill=\"%23999\" font-family=\"Arial\" font-size=\"12\">🎵</text></svg>'">
                        <div class="track-info">
                            <h4>${this.escapeHtml(this.truncateText(track.title, 50))}</h4>
                            <p>${this.escapeHtml(track.artist)}</p>
                        </div>
                        <button class="remove-btn" onclick="event.stopPropagation(); musicPlayer.removeFromPlaylist(${index})" title="Remove from playlist">
                            ✕
                        </button>
                    `;
                    
                    this.playlistContainer.appendChild(playlistItem);
                });
            }

            removeFromPlaylist(index) {
                try {
                    if (index >= 0 && index < this.playlist.length) {
                        const removedTrack = this.playlist.splice(index, 1)[0];
                        
                        // Adjust current track index if needed
                        if (index < this.currentTrack) {
                            this.currentTrack--;
                        } else if (index === this.currentTrack) {
                            // If removing current track, play next or previous
                            if (this.playlist.length > 0) {
                                if (this.currentTrack >= this.playlist.length) {
                                    this.currentTrack = 0;
                                }
                                this.playTrack(this.currentTrack);
                            } else {
                                // No tracks left
                                this.videoPlayer.src = '';
                                this.currentTrack = 0;
                            }
                        }
                        
                        this.renderPlaylist();
                        this.showMessage(`"${this.truncateText(removedTrack.title, 30)}" removed from playlist!`, 'success');
                    }
                } catch (error) {
                    console.error('Error removing from playlist:', error);
                    this.showMessage('Error removing track. Please try again.', 'error');
                }
            }

            playTrack(index) {
                try {
                    if (index >= 0 && index < this.playlist.length) {
                        this.currentTrack = index;
                        const track = this.playlist[index];
                        
                        console.log('Playing track:', track);
                        
                        // Update now playing info
                        this.updateNowPlaying(track);
                        
                        // Create YouTube embed URL with better parameters for loading
                        const embedUrl = `https://www.youtube.com/embed/${track.id}?autoplay=1&rel=0&modestbranding=1&fs=1&cc_load_policy=0&iv_load_policy=3&autohide=1`;
                        
                        console.log('Loading video URL:', embedUrl);
                        
                        // Update player status
                        this.playerStatus.textContent = `🎵 Loading: ${track.title}...`;
                        
                        // Load the video with error handling
                        this.videoPlayer.src = embedUrl;
                        
                        // Add load event listener
                        this.videoPlayer.onload = () => {
                            console.log('Video loaded successfully');
                            this.playerStatus.textContent = `🎵 Now Playing: ${track.title}`;
                            this.playPauseBtn.innerHTML = '⏸ Pause';
                        };
                        
                        // Add error event listener
                        this.videoPlayer.onerror = (e) => {
                            console.error('Video load error:', e);
                            this.playerStatus.textContent = `❌ Could not load: ${track.title}`;
                            this.showMessage('Video could not be loaded. It may be restricted or unavailable.', 'error');
                        };
                        
                        // Update after a short delay to allow for loading
                        setTimeout(() => {
                            if (this.videoPlayer.src === embedUrl) {
                                this.playerStatus.textContent = `🎵 Now Playing: ${track.title}`;
                                this.playPauseBtn.innerHTML = '⏸ Pause';
                            }
                        }, 2000);
                        
                        this.renderPlaylist();
                        
                        // Update page title
                        document.title = `${track.title} - YouTube Music Player`;
                        
                        console.log(`Attempting to play: ${track.title} (${track.id})`);
                    }
                } catch (error) {
                    console.error('Error playing track:', error);
                    this.playerStatus.textContent = '❌ Error playing track';
                    this.showMessage('Error playing track. The video may be restricted or unavailable.', 'error');
                }
            }

            updateNowPlaying(track) {
                this.nowPlaying.className = 'now-playing active';
                this.nowPlayingImage.src = track.thumbnail;
                this.nowPlayingImage.alt = track.title;
                this.nowPlayingTitle.textContent = this.truncateText(track.title, 50);
                this.nowPlayingArtist.textContent = track.artist;
            }

            previousTrack() {
                if (this.playlist.length === 0) {
                    this.showMessage('No tracks in playlist!', 'error');
                    this.playerStatus.textContent = 'No tracks in playlist';
                    return;
                }
                const prevIndex = this.currentTrack > 0 ? this.currentTrack - 1 : this.playlist.length - 1;
                this.playTrack(prevIndex);
            }

            nextTrack() {
                if (this.playlist.length === 0) {
                    this.showMessage('No tracks in playlist!', 'error');
                    this.playerStatus.textContent = 'No tracks in playlist';
                    return;
                }
                const nextIndex = (this.currentTrack + 1) % this.playlist.length;
                this.playTrack(nextIndex);
            }

            togglePlayPause() {
                try {
                    if (this.playlist.length === 0) {
                        this.showMessage('No tracks in playlist to play!', 'error');
                        return;
                    }

                    const currentSrc = this.videoPlayer.src;
                    
                    if (!currentSrc) {
                        // No video loaded, play first track
                        this.playTrack(this.currentTrack);
                        return;
                    }

                    if (currentSrc.includes('autoplay=1')) {
                        // Currently playing, pause by reloading without autoplay
                        const pausedUrl = currentSrc.replace('autoplay=1', 'autoplay=0');
                        this.videoPlayer.src = pausedUrl;
                        this.playPauseBtn.innerHTML = '▶ Play';
                        this.playerStatus.textContent = '⏸ Paused';
                    } else {
                        // Currently paused, play by reloading with autoplay
                        const playUrl = currentSrc.replace('autoplay=0', 'autoplay=1');
                        this.videoPlayer.src = playUrl;
                        this.playPauseBtn.innerHTML = '⏸ Pause';
                        const track = this.playlist[this.currentTrack];
                        this.playerStatus.textContent = `🎵 Playing: ${track.title}`;
                    }
                } catch (error) {
                    console.error('Play/pause error:', error);
                    this.showMessage('Playback control limited by YouTube embed restrictions. Try clicking a song directly.', 'error');
                }
            }
        }

        // Initialize the music player when the page loads
        let musicPlayer;
        document.addEventListener('DOMContentLoaded', () => {
            musicPlayer = new MusicPlayer();
        });
    </script>
</body>
</html>
